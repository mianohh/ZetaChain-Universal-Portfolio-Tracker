<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZetaChain Universal Portfolio Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üåê ZetaChain Universal Portfolio Tracker</h1>
            <p>Universal App with Cross-Chain NFT Rewards</p>
            <div class="universal-app-badge">
                <span class="badge-icon">‚ö°</span>
                <div class="badge-text">
                    <strong>Universal App</strong>
                    <span>Gateway Integration ‚Ä¢ onCall ‚Ä¢ onRevert ‚Ä¢ onAbort</span>
                </div>
            </div>
        </header>

        <div class="wallet-section">
            <button id="connectWallet" class="btn-primary">Connect Wallet</button>
            <div id="walletInfo" class="wallet-info hidden">
                <span id="walletAddress"></span>
                <span id="walletBalance"></span>
            </div>
        </div>

        <!-- ============ UNIVERSAL APP FEATURES (BOUNTY #1) ============ -->
        <div class="universal-app-section">
            <h2>‚ö° Universal App Features</h2>
            <div class="features-grid">
                <div class="feature-card oncall">
                    <div class="feature-icon">‚úÖ</div>
                    <h3>onCall()</h3>
                    <p>Successful cross-chain withdrawals processed automatically</p>
                    <div class="feature-status">Active</div>
                </div>
                <div class="feature-card onrevert">
                    <div class="feature-icon">üîÑ</div>
                    <h3>onRevert()</h3>
                    <p>100% automatic refunds when transactions fail</p>
                    <div class="feature-status">Active</div>
                </div>
                <div class="feature-card onabort">
                    <div class="feature-icon">üõ°Ô∏è</div>
                    <h3>onAbort()</h3>
                    <p>Immediate refunds for aborted transactions</p>
                    <div class="feature-status">Active</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Deposit Section -->
            <div class="card">
                <h2>üí∞ Deposit ZETA</h2>
                <p class="card-description">Create a position by depositing ZETA tokens</p>
                <div class="form-group">
                    <label>Amount (ZETA)</label>
                    <input type="number" id="depositAmount" placeholder="0.1" step="0.001" min="0.001">
                </div>
                <button id="depositBtn" class="btn-primary" disabled>Deposit & Create Position</button>
            </div>

            <!-- Positions Section -->
            <div class="card">
                <h2>üìä My Positions</h2>
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-label">Active Positions</span>
                        <span id="positionCount" class="stat-value">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Value</span>
                        <span id="totalDeposited" class="stat-value">0 ZETA</span>
                    </div>
                </div>
                <div id="positionsContainer">
                    <p class="no-positions">No positions yet. Deposit ZETA to get started.</p>
                </div>
            </div>

            <!-- Withdraw Section -->
            <div class="card">
                <h2>üåê Cross-Chain Withdraw</h2>
                <p class="card-description">Withdraw to any chain with automatic refund protection</p>
                <div class="form-group">
                    <label>Select Position</label>
                    <select id="positionSelect" disabled>
                        <option value="">Choose a position to withdraw</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Destination Chain</label>
                    <select id="destinationChain">
                        <optgroup label="EVM Chains">
                            <option value="11155111">Ethereum Sepolia</option>
                            <option value="97">BSC Testnet</option>
                            <option value="80001">Polygon Mumbai</option>
                        </optgroup>
                        <optgroup label="Non-EVM Chains">
                            <option value="18000001">Solana Devnet</option>
                            <option value="18000002">Sui Testnet</option>
                            <option value="18000003">TON Testnet</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label>Recipient Address</label>
                    <input type="text" id="destinationAddress" placeholder="Enter destination address">
                </div>
                <div class="form-group">
                    <label>Gas Limit <span class="hint">(‚â•150000 for success, <150000 to test revert)</span></label>
                    <input type="number" id="gasLimit" value="200000" min="100000">
                </div>
                <div class="gas-estimation">
                    <div class="gas-row">
                        <span>Base Gas:</span>
                        <span id="gasEstimate" class="gas-value">-</span>
                    </div>
                    <div class="gas-row">
                        <span>With 30% Safety Buffer:</span>
                        <span id="gasPremium" class="gas-value highlight">-</span>
                    </div>
                </div>
                <button id="withdrawBtn" class="btn-secondary" disabled>Withdraw Cross-Chain</button>
            </div>
        </div>

        <!-- NFT Rewards Section -->
        <div class="nft-section">
            <h2>üé® Universal NFT Badge</h2>
            <div class="nft-container">
                <div class="nft-visual">
                    <div id="badgeVisual" class="badge-locked">
                        <img src="badge.svg" alt="Safety Badge" class="badge-image">
                        <div id="badgeStatusText" class="badge-status-text">Locked</div>
                    </div>
                    <div id="badgeEligibility" class="eligibility-status">
                        ‚ùå Not Eligible
                    </div>
                </div>
                <div class="nft-actions">
                    <p id="badgeDescription" class="nft-description">Use the safety buffer to unlock your Universal NFT badge</p>
                    <button id="mintBadgeBtn" class="btn-nft" disabled>Mint Safety Badge</button>
                    <div class="nft-transfer">
                        <select id="transferChain" disabled>
                            <option value="">Transfer to...</option>
                            <option value="11155111">Ethereum</option>
                            <option value="97">BSC</option>
                            <option value="80001">Polygon</option>
                            <option value="18000001">Solana</option>
                            <option value="18000002">Sui</option>
                            <option value="18000003">TON</option>
                        </select>
                        <button id="transferBadgeBtn" class="btn-transfer" disabled>Transfer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction History -->
        <div class="history-section">
            <h3>üìú Recent Activity</h3>
            <div id="statusContainer">
                <p class="no-positions">No transactions yet</p>
            </div>
        </div>

        <!-- ============ ATTRIBUTION FOOTER (BOUNTY #3 REQUIREMENT) ============ -->
        <footer class="attribution-footer">
            <div class="attribution-content">
                <div class="attribution-badge">
                    <span class="ai-icon">ü§ñ</span>
                    <span class="powered-by">Powered by</span>
                </div>
                <div class="attribution-text">
                    <strong>Amazon Q</strong>
                    <p>Volatility Premium Algorithm & Architecture Generated by Amazon Q</p>
                </div>
            </div>
            <div class="bounty-info">
                <span class="bounty-tag bounty-1">Bounty #1: Universal App ($2,000 ZETA)</span>
                <span class="bounty-tag">Bounty #2: Universal AI App</span>
                <span class="bounty-tag">Bounty #3: Multi-Sponsor App</span>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js" 
            onerror="loadEthersFallback()"></script>
    <script>
        function loadEthersFallback() {
            console.log('Loading ethers.js from fallback CDN...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js';
            script.onload = () => console.log('Ethers.js loaded from fallback');
            script.onerror = () => {
                alert('Failed to load ethers.js. Please check your internet connection.');
            };
            document.head.appendChild(script);
        }
        
        function checkEthers() {
            if (typeof ethers !== 'undefined') {
                console.log('Ethers.js loaded successfully');
                return true;
            }
            return false;
        }
    </script>
    <script src="app.js"></script>
</body>
</html>
